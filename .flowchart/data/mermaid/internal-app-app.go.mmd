flowchart TD
    Start([App.Run Entry Point]) --> DebugStart[Log Application Start]

    DebugStart --> Context[Create Cancel Context]
    Context --> SignalGoroutine[Launch Signal Handler Goroutine]

    subgraph "Signal Handling"
        SignalGoroutine --> WaitSignal[Wait for OS Signals]
        WaitSignal --> SignalReceived{Signal Received?}
        SignalReceived -->|Yes| ShutdownCallback[Execute Shutdown Callback]
        ShutdownCallback --> ShutdownInit[shutdown.Initiate]
    end

    Context --> RegisterTasks[Register Shutdown Tasks]
    RegisterTasks --> RegisterWorker[Register worker.Stop]
    RegisterTasks --> RegisterApp[Register app.cleanup]

    RegisterTasks --> StartWorker[Start Worker]
    StartWorker --> WorkerStatus{worker.Start <br> Successful?}
    WorkerStatus -->|Error| ReturnError[Return Error to main.go]
    WorkerStatus -->|Success| WaitShutdown["Log Waiting State <br> <-shutdown.Done()"]

    WaitShutdown --> ShutdownTrigger{shutdown.Initiate <br> Called?}
    ShutdownTrigger -->|No| WaitShutdown
    ShutdownTrigger -->|Yes| ShutdownWait[shutdown.Wait]

    ShutdownInit --> ShutdownTrigger

    ShutdownWait --> WorkerStop[Execute worker.Stop]
    ShutdownWait --> AppCleanup[Execute app.cleanup]

    WorkerStop --> WaitGroup[a.wg.Wait <br> Wait for All Goroutines]
    AppCleanup --> WaitGroup

    WaitGroup --> Complete[Log Shutdown Complete]
    Complete --> ExitSuccess([Return nil to main.go])

    ReturnError --> ExitError([Return Error to main.go])

    %% Styling
    classDef process fill:#1e293b,stroke:#3498db,stroke-width:2px,color:#e2e8f0
    classDef decision fill:#334155,stroke:#ffc107,stroke-width:2px,color:#e2e8f0
    classDef terminator fill:#0f172a,stroke:#a78bfa,stroke-width:2px,color:#e2e8f0
    classDef error fill:#450a0a,stroke:#dc3545,stroke-width:2px,color:#e2e8f0
    classDef component fill:#1e3a5f,stroke:#4f9eff,stroke-width:2px,color:#e2e8f0
    classDef subgraphStyle fill:#1e293b,stroke:#64748b,stroke-width:2px

    class Start,ExitSuccess,ExitError terminator
    class WorkerStatus,SignalReceived,ShutdownTrigger decision
    class DebugStart,Context,RegisterTasks,StartWorker process
    class SignalGoroutine,WaitSignal,ShutdownCallback,ShutdownInit component
    class RegisterWorker,RegisterApp component
    class WaitShutdown,ShutdownWait,WorkerStop,AppCleanup process
    class WaitGroup,Complete process
    class ReturnError error
    class ShutdownInit,ShutdownTrigger critical
